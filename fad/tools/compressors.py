import asyncio
import os
from typing import List, Dict

from langchain.retrievers import ContextualCompressionRetriever
from langchain.retrievers.document_compressors import EmbeddingsFilter, DocumentCompressorPipeline
from langchain_core.callbacks import CallbackManagerForRetrieverRun
from langchain_core.documents import Document
from langchain_core.retrievers import BaseRetriever
from langchain_openai import OpenAIEmbeddings
from langchain_text_splitters import RecursiveCharacterTextSplitter


class SearchAPIRetriever(BaseRetriever):
    """Search API retriever."""
    pages: List[Dict] = []

    def _get_relevant_documents(
            self, query: str, *, run_manager: CallbackManagerForRetrieverRun
    ) -> List[Document]:
        docs = [
            Document(
                page_content=page.get("raw_content", ""),
                metadata={
                    "title": page.get("title", ""),
                    "source": page.get("url", ""),
                },
            )
            for page in self.pages
        ]

        return docs


class ContextCompressor:
    def __init__(self, documents, embeddings, max_results=5, **kwargs):
        self.max_results = max_results
        self.documents = documents
        self.kwargs = kwargs
        self.embeddings = embeddings
        self.similarity_threshold = os.environ.get("SIMILARITY_THRESHOLD", 0.38)

    def __get_contextual_retriever(self):
        splitter = RecursiveCharacterTextSplitter(chunk_size=1000, chunk_overlap=100)
        relevance_filter = EmbeddingsFilter(embeddings=self.embeddings,
                                            similarity_threshold=self.similarity_threshold)
        pipeline_compressor = DocumentCompressorPipeline(
            transformers=[splitter, relevance_filter]
        )
        base_retriever = SearchAPIRetriever(
            pages=self.documents
        )
        contextual_retriever = ContextualCompressionRetriever(
            base_compressor=pipeline_compressor, base_retriever=base_retriever
        )
        return contextual_retriever

    @staticmethod
    def pretty_print_docs(docs, top_n):
        return f"\n".join(f"Source: {d.metadata.get('source')}\n"
                          f"Title: {d.metadata.get('title')}\n"
                          f"Content: {d.page_content}\n"
                          for i, d in enumerate(docs) if i < top_n)

    def get_context(self, query, max_results=5, cost_callback=None):
        relevant_docs = self.get_relevant_docs(query)
        return ContextCompressor.pretty_print_docs(relevant_docs, max_results)

    def get_relevant_docs(self, query):
        compressed_docs = self.__get_contextual_retriever()
        # if cost_callback:
        #     cost_callback(estimate_embedding_cost(model=OPENAI_EMBEDDING_MODEL, docs=self.documents))
        relevant_docs = compressed_docs.invoke(query)
        return relevant_docs

    async def async_get_context(self, query, max_results=5, cost_callback=None):
        relevant_docs = await self.async_get_relevant_docs(query)
        return ContextCompressor.pretty_print_docs(relevant_docs, max_results)

    async def async_get_relevant_docs(self, query):
        compressed_docs = self.__get_contextual_retriever()
        # if cost_callback:
        #     cost_callback(estimate_embedding_cost(model=OPENAI_EMBEDDING_MODEL, docs=self.documents))
        relevant_docs = await asyncio.to_thread(compressed_docs.invoke, query)
        return relevant_docs


from dotenv import load_dotenv

load_dotenv()
OPENAI_EMBEDDING_MODEL = os.environ.get("OPENAI_EMBEDDING_MODEL", "text-embedding-3-small")


async def async_main():

    documents = [
        {'url': 'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf',
         'raw_content': '[Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 0, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=\' \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n1 \\n \\n  \\n \\nFinancial Highlights \\n➢ \\nFPT’s 9M23 net profit rose 20.3% yoy thanks to consistent growth of all \\nsegments, especially technology services and educations. \\n➢ \\nSigned revenue (new order value) of the Global IT Services reached \\nVND20,700bn (US$855.4m, +23.2% yoy), including 20 large-size deals \\nwith revenue over US$5m.  \\n➢ \\nWe forecast a FY23-25F EPS CAGR of 22%, based on the company’s \\nstrategy expansion to global IT services and education services. \\nInvestment Thesis \\nJapanese demand will drive IT Services revenue growth \\nWe forecast Overseas IT Services sales to maintain 27% a CAGR for FY24-25F \\ndriven by Japan and APAC markets.  9M23 revenue from Japan jumped 44% yoy \\nbecause Japan has stepped up spending on digital transformation in recent years \\nand Japanese corporates are reducing exposure to Chinese companies. FPT \\nbenefits due to the advantage of low costs as well as the ability to provide many \\ndiverse products and services. \\nStrategic M&A should support FPT’s long-term growth aspirations \\nFPT continued to focus on M&A to expand its consulting capacity worldwide with: \\n1) acquiring a strategic stake in Landing AI to strengthen computer vision \\ncapabilities, especially in the automotive industry; 2) purchasing 100% of Cardinal \\nPeak to exploit synergies with Cardinal’s 300 clients in North America (from Fortune \\n500 to start-ups) and capabilities in product engineering services; and 3) on \\nDecember 6, FPT announced its acquisition of an 80% stake in French IT consulting \\nfirm AOSIS, which has prowess in SAP, Data, Cloud, and smart solutions for \\nindustries such as aerospace, aviation, and transportation.  \\nEducation growth aligns with Government semiconductor initiatives \\nThis segment maintained high revenue growth in 9M23 (~USS$153.7m, +53.4% \\nyoy, ~10% total revenue). In 2017-22 period, full-time students have increased ~5.0 \\ntimes to~100k students. We believe that the education segment will attract many \\nstudents as the demand for IT increases. In Sep’23, FPT Education launched \\nSemiconductor and Microelectronics departments to enrol the first batch of students \\nin 2024. FPT Vietnam has proposed a framework to the Government to train 30,000- \\n50,000 semiconductor engineers by 2030. \\nValuation is significantly lower than regional peer’s average. \\nAlthough FPT’s P/E has expanded from 16.8x to 19.8x ytd but we believe this still \\nbe an attractive valuation as FPT is one of company that have a strong growth in \\n9M23, and can maintain a solid growth in coming years. Moreover, it is well below \\nthe regional peers’ average P/E of 31.6x. \\n \\n \\n \\n \\n \\n \\nSource: VNDIRECT RESEARCH \\nFinancial summary\\n12-22A\\n12-23E\\n12-24E\\n12-25E\\nRevenue growth\\n23.4%\\n20.8%\\n19.5%\\n20.0%\\nEPS growth\\n3.0%\\n7.9%\\n22.0%\\n19.4%\\nGross margin\\n39.5%\\n40.2%\\n40.3%\\n40.3%\\nNet profit margin\\n12.0%\\n12.4%\\n12.7%\\n12.7%\\nP/E (x)\\n18.0\\n17.0\\n14.9\\n12.5\\nRolling P/B (x)\\n3.4\\n4.5\\nROAE\\n27.2%\\n27.8%\\n27.6%\\n27.3%\\nNet debt to equity\\n23.4%\\n22.6%\\n8.3%\\n(3.3%)\\n \\nAnalyst(s): \\n \\nQuyen Nguyen \\nquyen.nguyen2@vndirect.com.vn \\n \\nFPT CORP (FPT) \\nAdd (Maintained)) \\nTECHNOLOGY \\n \\n \\n \\nA solid growth outlook \\n➢ We reiterate our ADD rating with 21.9% upside and 1.5% dividend yield. \\nWe increased our TP by 11% while the share price has increased 23.4% \\nsince our last report. \\n➢ Our higher TP is due to higher earnings projections for the global IT \\nservices and education business and rolling P/E valuation to FY24F. \\n➢ Trailling P/E of 19.8x is higher than its 3-year average of 17.6x but is \\njustified by strong EPS growth (CAGR 20.7% in FY24-25F) and is \\nsignificantly lower than regional peer’s average of 31.6x. \\n Current Price \\nVND96,200 \\n52Wk High/Low \\nVND99,000/VND64,742 \\nTarget Price \\nVND117,300 \\nPrevious TP \\nVND105,500 \\nTP vs Consensus \\n10.8% \\nUpside \\n21.9% \\nDividend Yield \\n1.5% \\nTotal stock return \\n23.4% \\n \\n \\nGrowth rating \\nPositive \\nValue rating \\nPositive \\nST Technical Analysis \\nPositive \\n \\n \\nMarket Cap \\nUS$5,065.2m \\n3m Avg daily value \\nUS$9.7m \\nAvail Foreign Room \\nUS$0.0m \\nOutstanding Shares \\n1,270.0m \\nFully diluted O/S \\n1,270.0m \\n \\n \\nFPT \\nPeers \\nVNI \\nP/E TTM \\n19.8 \\n31.6 \\n14.85 \\nP/B Current \\n5.2 \\n6.5 \\n1.7 \\nROA \\n9.8% \\n13.7% \\n2.0% \\nROE \\n28.1% \\n18.6% \\n11.7% \\n*as of 14/12/2023 \\n \\nShare Price performance  \\n \\n \\n Share price (%) \\n1M \\n3M \\n12M \\nOrdinary share \\n5.8 \\n-2.1 \\n48.2 \\nRelative to index \\n2.4 \\n-9.5 \\n12.0 \\n \\n \\nOwnership \\nTruong Gia Binh \\n7.01% \\nVietnam SCIC \\n5.79% \\nOthers \\n87.20% \\nBusiness Description \\n \\nFPT is the largest technology company in \\nVietnam with three main businesses: IT, \\ntelecom, and education. FPT reached USD1bn \\nin international sales in 2022. FPT is also \\nVietnam’s third largest telecommunications \\nservices company, and is among a handful of \\nfirms \\nthat \\nhave \\nestablished \\neducational \\nfacilities to support a skilled workforce. \\n \\n \\n \\n \\n \\n \\n-40%\\n0%\\n40%\\n80%\\nDec-22\\nApr-23\\nAug-23\\nDec-23\\nFPT\\nVNIndex\\n\'), Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 1, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=" \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n2 \\nCompany Profile \\nEstablished on September 13, 1988, with IT and Telecommunication as its core \\nbusiness sectors, FPT has provided services to 63 provinces and cities in \\nVietnam and has constantly expanded its software outsourcing business globally \\nsuch as US, Japan, APAC, EU. FPT currently operates in three major business \\nareas, including 1) Technology services, 2) Telecommunication, and 3) \\nEducation & Others. In particular, since 2018, FPT has set a strategic mission \\nto be one of the leading Digital Transformation (DX) corporations and become a \\ncomprehensive DX service provider over the world. FPT has been officially listed \\non the Ho Chi Minh Stock Exchange since 2006.  \\nFigure 1: FPT\'s 9M23 tech sales by geography \\n \\nFigure 2: FPT\'s 9M23 revenue by segment \\n \\n \\n \\n   Source: Company Report  \\n   Source: Company Report \\nFigure 3: Corporation’s business structure \\n \\n \\n                                                                                                                                                                                         Source: VNDIRECT RESEARCH \\n5.79%\\n7.01%\\n49%\\n100%\\n100%\\n100%\\n100%\\n48%\\n46.53%\\n25%\\n45.66%\\n49.52%\\n100%\\n100%\\nFPT Education\\nFPT Investment\\nEDUCATION AND \\nINVESTMENT\\nFPT Telecom\\nFPT Online\\nState Capital and \\nInvestment Corp. (SCIC)\\nFPT Capital\\nBOD\\nForeigners\\nFPT Corp (FPT)\\nTECHNOLOGY\\nFPT IS\\nFPT Digital\\nFPT Smart Cloud\\nSUBSIDIARIES\\nAFFILIATES\\nFPT Retail\\nSynnex FPT\\nTELECOMMUNICATIONS\\nFPT Software\\n"), Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 2, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=\' \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n3 \\n9M23 recap: Resilient growth in 9M23 \\nFigure 4: 9M23 and 11M23 business results \\n \\n   Source: VNDIRECT RESEARCH \\nFPT’s 9M23 results: solid performance led by technology segment \\nRevenue rose 22.4% yoy to VND37,927bn (US$1,567m) in 9M23 thanks to \\nconsistent growth of all segments. The technology segment (+26.9% yoy) \\ncontributed 59% to total revenue, while telecom and education also posted good \\ngrowth at 8.2% and 53.4% yoy, respectively. As a result, 9M23 NP increased by \\n20.3% yoy to VND4,742bn (US$196m), in line at 71.7% of our projection. \\nGlobal IT Services sustained the key growth in technology segment \\n9M23 revenue from global IT services increased 30.8% yoy to VND17,626bn \\n(US$728.4m), accounting for 78.2% of technology revenue thanks to strong \\nsales in Japan (+44.1% yoy) and APAC (+37.6% yoy), fueled by high demand \\nfor IT spending in these markets, especially spending for Digital Transformation \\nservices. Signed revenue (new order value) of the Global IT Services reached \\nVND20,700bn (US$855.4m) (+23.2% yoy).The number of large deals increased \\nby 11% yoy while the value of large deals increased by 66% yoy, showing a shift \\ntowards larger deals and the effectiveness of FPT\\\'s "whale-hunting" strategy. \\nDomestic IT service maintained modest growth at +14.7% yoy. \\nTelecom services maintained double-digit growth \\nTelecom services recorded double-digit growth with revenue of VND11,278bn \\n(US$466m) (+10.1% yoy) and PBT of VND2,217bn (US$91.6m) (+15% yoy) in \\n9M23. Pre-tax margin was 19.7% vs 18.8% in 9M22. The margin increase was \\ndue to higher contribution from data centers that FPT plans to expand its \\ncapacity to meet high demand for digital transformation in Vietnam. \\nEducation showed fast growing business \\nThis segment continued to see strong revenue growth, reaching VND3,720bn \\n(US$153.7m) (+53.4% yoy) in 9M23. In September, FPT Education launched a \\nSemiconductor and Microelectronics departments to enroll the first batch of \\nstudents in 2024. We believe this segment will continue to show strong \\nperformance and IT business will benefit from synergies with the education \\nsegment. \\nQuick update on 11M23 results \\nIn 11M23, FPT’s revenue and net profit reached VND47,201bn (US$1,950m) \\nand VND6,027bn (US$249m), respectively, up by 20.3% and 19% yoy, in line at \\n89% and 91% of our full-year projection. Technology / Telecom services / \\nEducation revenue still posted a resilient growth of 23.2%/7.5%/52.6% yoy, \\nrespectively. \\n\'), Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 3, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=" \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n4 \\nFY23-25F outlook: Earnings growth sustained in FY23-25F \\nFigure 5: FY23-25F earnings forecasts revision \\n \\n   Source: VNDIRECT RESEARCH \\n \\nStrong IT services revenue growth likely to continue in FY24-25F \\nIn 9M23, revenue from Japan sustained grow impressively, jumped by 44% yoy \\n(despite of the depreciation of JPY) vs +12% yoy in 9M22 thanks to 1) Japan \\nhas stepped up spending on digital transformation in recent years, 2) Japanese \\ncorporates reducing exposure to Chinese companies. FPT benefits due to the \\nadvantage of low costs as well as the ability to provide many diverse products \\nand services. The Japan acceleration offsets US deceleration, sales growth in \\nthe US slowed to 14.2% yoy in 9M23 from 42.4% yoy a year ago as the negative \\nimpact from the prolonged monetary tightening by the Fed.  \\nWe expect that FPT\'s overseas IT outsourcing services-maintained c.27% yoy \\ngrowth in the long-term base on: \\n• \\nFPT continued to focus on M&A strategy to expand its consulting \\ncapacity worldwide: 1) In October, FPT entered into a strategic \\npartnership with Landing AI, a computer vision platform in the U.S. With \\nthe partnership, FPT will look to implement computer vision solutions for \\nautomotive, manufacturing, healthcare and other industries. FPT and \\nLanding AI will also look to educate and train people in AI in Vietnam. \\nFPT expects to have more revenue from AI in FY24F to improve \\noperating efficiency (due to higher profit margins than FPT\'s traditional \\nservices). This revenue stream is currently relatively small. 2) In \\nNovember, FPT announced the acquisition 100% of Cardinal Peak (a \\nUS-based technology service provider with a customer base of more \\nthan 300 companies) to strengthen its product engineering capabilities \\nin North America. Through this transaction, FPT will be able to offer their \\nservices to existing Cardinal Peak customers, and leverage Cardinal \\nPeak\'s expertise and 20 years of experience into its existing technology \\ncapabilities to serve its existing clients. 3) In December, FPT announced \\nits acquisition of an 80% stake in French IT consulting firm AOSIS.  FPT \\nplans to leverage AOSIS\'s prowess in SAP, Data, Cloud, and Business \\nintelligence solutions, with a focus on the aerospace, aviation, and \\n"), Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 4, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=" \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n5 \\ntransportation sectors. With over 100 local experts and four offices \\njoining its existing global network, the company is poised to strengthen \\nits best-shore delivery capabilities for the French and European \\nmarkets. \\n• \\nAbility to unlock new clients and win larger-orders should support \\nits long-term growth: Regarding its strategy in key international \\nmarkets such as Japan, America, etc, FPT targets mega customers \\n(revenue of USD1 - 5m) and large customers (above +USD5m) to \\naccess high-value contracts. Notably, these companies cannot easily \\nchange partners, so signed contracts often have long-term value, \\nensuring medium-term revenue for businesses. In 9M23, the number of \\nmega deals increased from 115 to 153 and the number of the large deals \\nalso increased from 18 to 20 with the value of large deals increased by \\n66% yoy, confirming the effectiveness of FPT\'s shift to larger client’s \\nstrategy. We believe that enhancing FPT\'s technological capabilities will \\nalso help the company win more large contracts in the future. \\nFigure 6: FPT’s global IT services revenue by markets in 9M23 \\n(VNDbn) \\n \\nFigure 7: Number of clients with revenue above US$1m \\n \\n \\n \\n   Source: Company Report  \\n   Source: VNDIRECT RESEARCH \\n \\nWe expect that FPT\'s technology revenue will maintain their growth trajectory to \\ndeliver a growth of CAGR 23.5% in FY23-25F. In which global IT services is \\nexpected to reach CAGR 27.7% in FY23-25F driven by 1) Positive revenue \\nexpectations for the Japanese market and APAC and 2) IT spending in the US \\nand EU will improve in FY24-25F. \\nEducation is FPT’s fastest growing business.  \\nThe segment posted 53.4% yoy revenue growth in 9M23. FPT Education also \\ngenerates PBT margin of 37% in 9M23, which is the highest profit margin of any \\nof FPT’s business segments. We expect the education business may still \\nmaintain its strong growth momentum in FY23-25F base on:  \\n• \\nFPT increased its investment in education segment. FPT allocated \\n29% of its 2023 investment budget for education, equivalent \\n"), Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 5, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=\' \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n6 \\nVND1,700bn (+112.5% yoy). Segment capex has increased by 33% \\nCAGR in 2018-2023, reflects the commitment to education.  \\n• \\nFPT expands training sector. In Sep’23, FPT University established \\nsemiconductor and microelectronics departments to enrol the first batch \\nof students in 2024. FPT Vietnam has proposed a framework to the \\ngovernment to train 30,000-50,000 semiconductor engineers by 2030. \\nIn additional, in October, FPT and Landing AI launched a project to \\neducate and train people in AI in Vietnam. Dr. Andrew Ng (Landing AI’s \\nfounder and CEO, cofounder of Google Brain, and former Chief Scientist \\nat Baidu) will serve as advisor to FPT to create a comprehensive AI \\ncurriculum for students from grade 1 to grade 12. We believe that \\ninvesting in education and the workforce should support IT talent pool \\nto grow in the coming years, leading to attracting investments from large \\ninternational companies, which should further develop technological \\ncapacity in Vietnam. \\nWe forecast education revenue to grow by +39% yoy in FY23F and 28% yoy in \\nFY24/FY25F, a key driver of our expected earnings growth given that the \\neducation segment’s 9M23 PBT margin of 37% is the highest of any of FPT’s \\nbusiness segments.  \\nFigure 8: FPT doubled its investment in education in 2023 vs 2022 \\n(VNDbn) \\n \\nFigure 9: FPT’s yearly average students from 2017-2025 \\n \\n \\n \\n   Source: Company Report  \\n   Source: VNDIRECT RESEARCH \\n \\n \\n \\n \\n\'), Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 6, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=" \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n7 \\nValuation \\nReiterate ADD with a higher TP of VND117,300 \\nWe maintain our rating Add with raising the 1-year target price to 117,300 \\nVND/share (21.9% upside). Our valuation is based on SOTP of three main \\nbusiness segments\'s P/E target valuation. We use average adjusted P/E of \\npeers at 21.0x for technology segment, while use 15.0x P/E for \\ntelecommunication segment (lower than peers’ average) as moderate growth in \\ncoming years. We also apply 15.0x P/E target for education as same as P/E \\nVNIndex with heavily invested and is expected to made a strong growth in \\ncoming years. \\nOverall, our TP equal to P/E of 22.5x and 18.4x for FY23/FY24F, respectively. \\nFigure 10: P/E-based valuation \\n \\n   Source: VNDIRECT RESEARCH \\n \\nFigure 11: Peer comparison (as of 14/12/2023) \\n \\n \\n   Source: VNDIRECT RESEARCH, BLOOMBERG \\nNote: Adjusted P/E = P/E ratio divided by the relevant market average times the P/E of the VN-Index. \\nVNDbn\\nFPT\'s \\nownership\\nNP 2024F\\nP/E\\nEquity value \\nFY24F\\nTechnology\\n100%\\n4,542\\n              \\n21.0\\n                 \\n95,379\\n               \\nTelecommunication\\n46%\\n2,860\\n              \\n15.0\\n                 \\n19,686\\n               \\nEducation\\n100%\\n2,262\\n              \\n15.0\\n                 \\n33,934\\n               \\nTotal\\n148,999\\n             \\nEquity value FY23F (VNDbn)\\n148,999\\n             \\nOutstanding share\\n1,270,000,000\\nValue per share (VND/share)\\n117,322\\n             \\nTarget price (rounded) (VND/share)\\n117,300\\n             \\n"), Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 7, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=\' \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n8 \\nFigure 12: Sensitivity analysis table valuation \\n \\n   Source: VNDIRECT RESEARCH \\n \\n \\nFPT is trading at trailling P/E of 19.8x, which is higher than its 3-year average \\ntrailing P/E (17.6x) but significantly lower than regional peers average (31.6x). \\nOur TP implies an 18.4x P/E forward FY24F, which we think is attractive \\nregarding solid earnings growth of CAGR 22% in FY23-25F. \\nFigure 13: P/E of FPT vs technology peers \\n \\n   Source: VNDIRECT RESEARCH \\n \\n \\n \\n \\n \\n \\n \\nDownside risk: \\n• \\nInability to gain market share in competition from Indian peers in \\noverseas markets. In the global market, India is generally the first IT \\noutsourcing destination for businesses given that it has a mature \\nsoftware industry with a large number of skillful IT specialists. As such, \\nIndia will continue to be a favorite destination for IT services. We \\nbelieve that competition from Indian rivals is a big challenge for FPT in \\nterms of its ability to gain global market share.  \\n• \\nShortage of IT personnel and increase in labor costs. FPT’s IT services \\nsector is labor-intensive, hence, a significant increase in labor costs \\nmay affect the company’s operating costs.  \\n• \\nThe longer-than-expected recession impacting IT services spend  \\n• \\nForeign exchange risk: FPT’s costs tend to be in local currency, while \\nrevenues are in foreign currency.  \\n\'), Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 8, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=\' \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n9 \\n• \\nFierce competition in the telecom segment. We believe two large state-\\nowned carriers – Viettel (Unlisted) and VNPT (Unlisted) is a concern for \\nFPT in the telecom segment. In order to compete, FPT needs to boost \\nspending on upgrading infrastructure and provide value-added services \\non its products to expand its penetration, which would lead to rising \\ninvestment costs. \\nPotential re-rating catalysts  \\n• \\nHigher-than-expected global IT services revenue since FY24F. FPT is \\nfocusing on M&A to expand its brand and customer base overseas to \\nexpand its digital transformation business extensively, translating into \\ngreat potential for the company, in our view. Successful M&A deals will \\nhelp FPT increase market share in the oversea. \\n \\n \\n \\n\'), Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 9, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=" \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n10 \\nValuation \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\nSource: VND RESEARCH \\n \\n \\n0%\\n1%\\n2%\\n4%\\n5%\\n6%\\n7%\\n6.7\\n8.7\\n10.7\\n12.7\\n14.7\\n16.7\\n18.7\\n01-21A\\n07-21A\\n01-22A\\n07-22A\\n01-23E\\n07-23E\\nRolling P/E (x) (lhs)\\nEPS growth (rhs)\\n23.0%\\n23.7%\\n24.4%\\n25.1%\\n25.9%\\n26.6%\\n27.3%\\n28.0%\\n1.5\\n2.0\\n2.5\\n3.0\\n3.5\\n4.0\\n4.5\\n5.0\\n01-21A\\n07-21A\\n01-22A\\n07-22A\\n01-23E\\n07-23E\\nRolling P/B (x) (lhs)\\nROAE (rhs)\\nIncome statement\\n(VNDbn)\\n12-23E\\n12-24E\\n12-25E\\nNet revenue\\n53,152\\n63,513\\n76,203\\nCost of sales\\n(31,783)\\n(37,941)\\n(45,476)\\nGen & admin expenses\\n(5,315)\\n(6,351)\\n(7,620)\\nSelling expenses\\n(7,441)\\n(8,892)\\n(10,668)\\nOperating profit\\n8,612\\n10,329\\n12,438\\nOperating EBITDA\\n6,201\\n7,485\\n8,998\\nDepreciation and amortisation\\n2,412\\n2,845\\n3,441\\nOperating EBIT\\n8,612\\n10,329\\n12,438\\nInterest income\\n2,066\\n1,938\\n2,142\\nFinancial expense\\n(1,471)\\n(1,313)\\n(1,508)\\nNet other income\\n64\\n77\\n92\\nIncome from associates & JVs\\n155\\n471\\n573\\nPre-tax profit\\n9,427\\n11,503\\n13,738\\nTax expense\\n(1,458)\\n(1,779)\\n(2,124)\\nMinority interest\\n(1,353)\\n(1,651)\\n(1,972)\\nNet profit\\n6,616\\n8,072\\n9,641\\nAdj. net profit to ordinary\\n6,616\\n8,072\\n9,641\\nOrdinary dividends\\n(2,540)\\n(2,540)\\n(2,540)\\nRetained earnings\\n4,076\\n5,532\\n7,101\\nBalance sheet\\n(VNDbn)\\n12-23E\\n12-24E\\n12-25E\\nCash and equivalents\\n14,069\\n20,526\\n28,607\\nShort term investments\\n20,047\\n21,906\\n23,954\\nAccounts receivables\\n9,251\\n11,055\\n13,263\\nInventories\\n2,082\\n2,485\\n2,979\\nOther current assets\\n1,493\\n1,785\\n2,141\\nTotal current assets\\n46,943\\n57,757\\n70,945\\nFixed assets\\n15,242\\n18,827\\n24,352\\nTotal investments\\n3,113\\n3,458\\n3,878\\nOther long-term assets\\n4,798\\n5,734\\n6,879\\nTotal assets\\n70,096\\n85,776\\n106,055\\nShort-term debt\\n19,504\\n21,565\\n24,495\\nAccounts payable\\n3,766\\n4,496\\n5,389\\nOther current liabilities\\n12,851\\n18,830\\n26,434\\nTotal current liabilities\\n36,122\\n44,891\\n56,318\\nTotal long-term debt\\n1,773\\n2,128\\n2,554\\nOther liabilities\\n336\\n401\\n481\\nShare capital\\n12,700\\n12,700\\n12,700\\nRetained earnings reserve\\n11,063\\n15,688\\n21,812\\nShareholders\' equity\\n26,632\\n31,889\\n38,692\\nMinority interest\\n5,232\\n6,466\\n8,010\\nTotal liabilities & equity\\n70,096\\n85,776\\n106,055\\nCash flow statement\\n(VNDbn)\\n12-23E\\n12-24E\\n12-25E\\nPretax profit\\n9,427\\n11,503\\n13,738\\nDepreciation & amortisation\\n2,412\\n2,845\\n3,441\\nTax paid\\n(1,458)\\n(1,779)\\n(2,124)\\nOther adjustments\\n78\\n86\\n99\\nChange in working capital\\n3,683\\n6,563\\n8,281\\nCash flow from operations\\n14,141\\n19,218\\n23,433\\nCapex\\n(3,106)\\n(4,454)\\n(6,238)\\nProceeds from assets sales\\n0\\n0\\n0\\nOthers\\n(7,011)\\n(1,859)\\n(2,048)\\nOther non-current assets changes\\n0\\n0\\n0\\nCash flow from investing activities\\n(10,117)\\n(6,313)\\n(8,286)\\nNew share issuance\\n0\\n0\\n0\\nShares buyback\\n0\\n0\\n0\\nNet borrowings\\n8,896\\n2,416\\n3,355\\nOther financing cash flow\\n0\\n(382)\\n(824)\\nDividends paid\\n(3,175)\\n(3,175)\\n(3,175)\\nCash flow from financing activities\\n5,721\\n(1,141)\\n(644)\\nCash and equivalents at beginning of period\\n6,440\\n14,069\\n20,526\\nTotal cash generated\\n9,745\\n11,763\\n14,504\\nCash and equivalents at the end of period\\n16,185\\n25,832\\n35,030\\n"), Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 10, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=\' \\n \\n \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n11 \\n \\n \\n \\n \\n \\n \\nDISCLAIMER \\nThis report has been written and distributed by Research Department, VNDIRECT Securities Corporation. The information contained in \\nthis report is prepared from data believed to be correct and reliable at the time of issuance of this report. Unless otherwise stated, this \\nreport is based upon sources that VNDIRECT considers to be reliable. These sources may include but are not limited to data from the \\nstock exchange or market where the subject security is listed, or, where appropriate, any other market. Information on the company(ies) \\nare based on published statements, information disclosure and announcements of the company(ies), and information resulting from our \\nresearch. VNDIRECT has no responsibility for the accuracy, adequacy or completeness of such information. \\nAll estimates, projections, forecasts and expression of opinions contained in this report reflect the personal views and opinions of the \\nanalyst(s) responsible for the production of this report. These opinions may not represent the views and position of VNDIRECT and may \\nchange without notice. \\nThis report has been prepared for information purposes only. The information and opinions in this report should not be considered as an \\noffer, recommendation or solicitation to buy or sell the subject securities, related investments or other financial instruments. VNDIRECT \\ntakes no responsibility for any consequences arising from using the content of this report in any form.  \\nThis report and all of its content belongs to VNDIRECT. No part of this report may be copied or reproduced in any form or redistributed \\nin whole or in part, for any purpose without the prior written consent of VNDIRECT. \\n \\nRECOMMENDATION FRAMEWORK \\nStock Ratings \\nDefinition: \\n Add \\nThe stock’s total return is expected to reach 15% or higher over the next 12 months. \\n Hold \\nThe stock’s total return is expected to be between negative 10% and positive 15% over the next 12 months. \\n Reduce \\nThe stock’s total return is expected to fall below negative 10% over the next 12 months. \\nThe total expected return of a stock is defined as the sum of the: (i) percentage difference between the target price and the current \\nprice and (ii) the forward net dividend yields of the stock. Stock price targets have an investment horizon of 12 months. \\n \\n \\nGrowth Ratings \\nDefinition: \\n Positive \\nWe forecast the company to have stronger earnings growth that than peers over the investment horizon. \\n Neutral \\nWe forecast the company’s earnings growth to be in line with peers over the investment horizon. \\n Negative \\nWe forecast the company to have weaker earnings growth that than peers over the investment horizon. \\n \\n \\nValue Ratings \\nDefinition: \\n Positive \\nThe current share price is lower than peers on the basis of historical P/E, P/B or another ratio specified. \\n Neutral \\nThe current share price is in-line with peers on the basis of historical P/E, P/B or another ratio specified. \\n Negative \\nThe current share price is higher than peers on the basis of historical P/E, P/B or another ratio specified. \\n \\n \\nSector Ratings \\nDefinition: \\n Overweight \\nStocks in the sector have, on a market cap-weighted basis, a positive absolute recommendation. \\n Neutral \\nStocks in the sector have, on a market cap-weighted basis, a neutral absolute recommendation. \\n Underweight \\nStocks in the sector have, on a market cap-weighted basis, a negative absolute recommendation. \\n \\n \\n \\nBarry Weisblatt –  Head of Research \\nEmail: barry.weisblatt@vndirect.com.vn \\nBach Phan Nhu –  Senior Analyst \\nEmail: bach.phannhu@vndirect.com.vn \\nQuyen Nguyen –  Analyst \\nEmail:  quyen.nguyen2@vndirect.com.vn \\n –  \\nEmail:  \\n –  \\nEmail:  \\n –  \\nEmail:  \\n –  \\nEmail:  \\n \\nVNDIRECT Securities Corporation \\n1 Nguyen Thuong Hien Str – Hai Ba Trung Dist – Ha Noi  \\nTel: +84 2439724568 \\nEmail: research@vndirect.com.vn \\nWebsite: https://vndirect.com.vn \\n \\n\')]'}]
    embeddings = OpenAIEmbeddings(model=OPENAI_EMBEDDING_MODEL, check_embedding_ctx_length=False)
    compressor = ContextCompressor(documents, embeddings)
    query = 'FPT stock performance analysis 2023'
    rs = await compressor.async_get_relevant_docs(query=query)
    printable_rs = ContextCompressor.pretty_print_docs(rs, top_n=5)
    # print(printable_rs)
    return printable_rs

def main():
    embeddings = OpenAIEmbeddings(model=OPENAI_EMBEDDING_MODEL, check_embedding_ctx_length=False)
    documents = [
        {'url': 'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf',
         'raw_content': '[Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 0, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=\' \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n1 \\n \\n  \\n \\nFinancial Highlights \\n➢ \\nFPT’s 9M23 net profit rose 20.3% yoy thanks to consistent growth of all \\nsegments, especially technology services and educations. \\n➢ \\nSigned revenue (new order value) of the Global IT Services reached \\nVND20,700bn (US$855.4m, +23.2% yoy), including 20 large-size deals \\nwith revenue over US$5m.  \\n➢ \\nWe forecast a FY23-25F EPS CAGR of 22%, based on the company’s \\nstrategy expansion to global IT services and education services. \\nInvestment Thesis \\nJapanese demand will drive IT Services revenue growth \\nWe forecast Overseas IT Services sales to maintain 27% a CAGR for FY24-25F \\ndriven by Japan and APAC markets.  9M23 revenue from Japan jumped 44% yoy \\nbecause Japan has stepped up spending on digital transformation in recent years \\nand Japanese corporates are reducing exposure to Chinese companies. FPT \\nbenefits due to the advantage of low costs as well as the ability to provide many \\ndiverse products and services. \\nStrategic M&A should support FPT’s long-term growth aspirations \\nFPT continued to focus on M&A to expand its consulting capacity worldwide with: \\n1) acquiring a strategic stake in Landing AI to strengthen computer vision \\ncapabilities, especially in the automotive industry; 2) purchasing 100% of Cardinal \\nPeak to exploit synergies with Cardinal’s 300 clients in North America (from Fortune \\n500 to start-ups) and capabilities in product engineering services; and 3) on \\nDecember 6, FPT announced its acquisition of an 80% stake in French IT consulting \\nfirm AOSIS, which has prowess in SAP, Data, Cloud, and smart solutions for \\nindustries such as aerospace, aviation, and transportation.  \\nEducation growth aligns with Government semiconductor initiatives \\nThis segment maintained high revenue growth in 9M23 (~USS$153.7m, +53.4% \\nyoy, ~10% total revenue). In 2017-22 period, full-time students have increased ~5.0 \\ntimes to~100k students. We believe that the education segment will attract many \\nstudents as the demand for IT increases. In Sep’23, FPT Education launched \\nSemiconductor and Microelectronics departments to enrol the first batch of students \\nin 2024. FPT Vietnam has proposed a framework to the Government to train 30,000- \\n50,000 semiconductor engineers by 2030. \\nValuation is significantly lower than regional peer’s average. \\nAlthough FPT’s P/E has expanded from 16.8x to 19.8x ytd but we believe this still \\nbe an attractive valuation as FPT is one of company that have a strong growth in \\n9M23, and can maintain a solid growth in coming years. Moreover, it is well below \\nthe regional peers’ average P/E of 31.6x. \\n \\n \\n \\n \\n \\n \\nSource: VNDIRECT RESEARCH \\nFinancial summary\\n12-22A\\n12-23E\\n12-24E\\n12-25E\\nRevenue growth\\n23.4%\\n20.8%\\n19.5%\\n20.0%\\nEPS growth\\n3.0%\\n7.9%\\n22.0%\\n19.4%\\nGross margin\\n39.5%\\n40.2%\\n40.3%\\n40.3%\\nNet profit margin\\n12.0%\\n12.4%\\n12.7%\\n12.7%\\nP/E (x)\\n18.0\\n17.0\\n14.9\\n12.5\\nRolling P/B (x)\\n3.4\\n4.5\\nROAE\\n27.2%\\n27.8%\\n27.6%\\n27.3%\\nNet debt to equity\\n23.4%\\n22.6%\\n8.3%\\n(3.3%)\\n \\nAnalyst(s): \\n \\nQuyen Nguyen \\nquyen.nguyen2@vndirect.com.vn \\n \\nFPT CORP (FPT) \\nAdd (Maintained)) \\nTECHNOLOGY \\n \\n \\n \\nA solid growth outlook \\n➢ We reiterate our ADD rating with 21.9% upside and 1.5% dividend yield. \\nWe increased our TP by 11% while the share price has increased 23.4% \\nsince our last report. \\n➢ Our higher TP is due to higher earnings projections for the global IT \\nservices and education business and rolling P/E valuation to FY24F. \\n➢ Trailling P/E of 19.8x is higher than its 3-year average of 17.6x but is \\njustified by strong EPS growth (CAGR 20.7% in FY24-25F) and is \\nsignificantly lower than regional peer’s average of 31.6x. \\n Current Price \\nVND96,200 \\n52Wk High/Low \\nVND99,000/VND64,742 \\nTarget Price \\nVND117,300 \\nPrevious TP \\nVND105,500 \\nTP vs Consensus \\n10.8% \\nUpside \\n21.9% \\nDividend Yield \\n1.5% \\nTotal stock return \\n23.4% \\n \\n \\nGrowth rating \\nPositive \\nValue rating \\nPositive \\nST Technical Analysis \\nPositive \\n \\n \\nMarket Cap \\nUS$5,065.2m \\n3m Avg daily value \\nUS$9.7m \\nAvail Foreign Room \\nUS$0.0m \\nOutstanding Shares \\n1,270.0m \\nFully diluted O/S \\n1,270.0m \\n \\n \\nFPT \\nPeers \\nVNI \\nP/E TTM \\n19.8 \\n31.6 \\n14.85 \\nP/B Current \\n5.2 \\n6.5 \\n1.7 \\nROA \\n9.8% \\n13.7% \\n2.0% \\nROE \\n28.1% \\n18.6% \\n11.7% \\n*as of 14/12/2023 \\n \\nShare Price performance  \\n \\n \\n Share price (%) \\n1M \\n3M \\n12M \\nOrdinary share \\n5.8 \\n-2.1 \\n48.2 \\nRelative to index \\n2.4 \\n-9.5 \\n12.0 \\n \\n \\nOwnership \\nTruong Gia Binh \\n7.01% \\nVietnam SCIC \\n5.79% \\nOthers \\n87.20% \\nBusiness Description \\n \\nFPT is the largest technology company in \\nVietnam with three main businesses: IT, \\ntelecom, and education. FPT reached USD1bn \\nin international sales in 2022. FPT is also \\nVietnam’s third largest telecommunications \\nservices company, and is among a handful of \\nfirms \\nthat \\nhave \\nestablished \\neducational \\nfacilities to support a skilled workforce. \\n \\n \\n \\n \\n \\n \\n-40%\\n0%\\n40%\\n80%\\nDec-22\\nApr-23\\nAug-23\\nDec-23\\nFPT\\nVNIndex\\n\'), Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 1, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=" \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n2 \\nCompany Profile \\nEstablished on September 13, 1988, with IT and Telecommunication as its core \\nbusiness sectors, FPT has provided services to 63 provinces and cities in \\nVietnam and has constantly expanded its software outsourcing business globally \\nsuch as US, Japan, APAC, EU. FPT currently operates in three major business \\nareas, including 1) Technology services, 2) Telecommunication, and 3) \\nEducation & Others. In particular, since 2018, FPT has set a strategic mission \\nto be one of the leading Digital Transformation (DX) corporations and become a \\ncomprehensive DX service provider over the world. FPT has been officially listed \\non the Ho Chi Minh Stock Exchange since 2006.  \\nFigure 1: FPT\'s 9M23 tech sales by geography \\n \\nFigure 2: FPT\'s 9M23 revenue by segment \\n \\n \\n \\n   Source: Company Report  \\n   Source: Company Report \\nFigure 3: Corporation’s business structure \\n \\n \\n                                                                                                                                                                                         Source: VNDIRECT RESEARCH \\n5.79%\\n7.01%\\n49%\\n100%\\n100%\\n100%\\n100%\\n48%\\n46.53%\\n25%\\n45.66%\\n49.52%\\n100%\\n100%\\nFPT Education\\nFPT Investment\\nEDUCATION AND \\nINVESTMENT\\nFPT Telecom\\nFPT Online\\nState Capital and \\nInvestment Corp. (SCIC)\\nFPT Capital\\nBOD\\nForeigners\\nFPT Corp (FPT)\\nTECHNOLOGY\\nFPT IS\\nFPT Digital\\nFPT Smart Cloud\\nSUBSIDIARIES\\nAFFILIATES\\nFPT Retail\\nSynnex FPT\\nTELECOMMUNICATIONS\\nFPT Software\\n"), Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 2, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=\' \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n3 \\n9M23 recap: Resilient growth in 9M23 \\nFigure 4: 9M23 and 11M23 business results \\n \\n   Source: VNDIRECT RESEARCH \\nFPT’s 9M23 results: solid performance led by technology segment \\nRevenue rose 22.4% yoy to VND37,927bn (US$1,567m) in 9M23 thanks to \\nconsistent growth of all segments. The technology segment (+26.9% yoy) \\ncontributed 59% to total revenue, while telecom and education also posted good \\ngrowth at 8.2% and 53.4% yoy, respectively. As a result, 9M23 NP increased by \\n20.3% yoy to VND4,742bn (US$196m), in line at 71.7% of our projection. \\nGlobal IT Services sustained the key growth in technology segment \\n9M23 revenue from global IT services increased 30.8% yoy to VND17,626bn \\n(US$728.4m), accounting for 78.2% of technology revenue thanks to strong \\nsales in Japan (+44.1% yoy) and APAC (+37.6% yoy), fueled by high demand \\nfor IT spending in these markets, especially spending for Digital Transformation \\nservices. Signed revenue (new order value) of the Global IT Services reached \\nVND20,700bn (US$855.4m) (+23.2% yoy).The number of large deals increased \\nby 11% yoy while the value of large deals increased by 66% yoy, showing a shift \\ntowards larger deals and the effectiveness of FPT\\\'s "whale-hunting" strategy. \\nDomestic IT service maintained modest growth at +14.7% yoy. \\nTelecom services maintained double-digit growth \\nTelecom services recorded double-digit growth with revenue of VND11,278bn \\n(US$466m) (+10.1% yoy) and PBT of VND2,217bn (US$91.6m) (+15% yoy) in \\n9M23. Pre-tax margin was 19.7% vs 18.8% in 9M22. The margin increase was \\ndue to higher contribution from data centers that FPT plans to expand its \\ncapacity to meet high demand for digital transformation in Vietnam. \\nEducation showed fast growing business \\nThis segment continued to see strong revenue growth, reaching VND3,720bn \\n(US$153.7m) (+53.4% yoy) in 9M23. In September, FPT Education launched a \\nSemiconductor and Microelectronics departments to enroll the first batch of \\nstudents in 2024. We believe this segment will continue to show strong \\nperformance and IT business will benefit from synergies with the education \\nsegment. \\nQuick update on 11M23 results \\nIn 11M23, FPT’s revenue and net profit reached VND47,201bn (US$1,950m) \\nand VND6,027bn (US$249m), respectively, up by 20.3% and 19% yoy, in line at \\n89% and 91% of our full-year projection. Technology / Telecom services / \\nEducation revenue still posted a resilient growth of 23.2%/7.5%/52.6% yoy, \\nrespectively. \\n\'), Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 3, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=" \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n4 \\nFY23-25F outlook: Earnings growth sustained in FY23-25F \\nFigure 5: FY23-25F earnings forecasts revision \\n \\n   Source: VNDIRECT RESEARCH \\n \\nStrong IT services revenue growth likely to continue in FY24-25F \\nIn 9M23, revenue from Japan sustained grow impressively, jumped by 44% yoy \\n(despite of the depreciation of JPY) vs +12% yoy in 9M22 thanks to 1) Japan \\nhas stepped up spending on digital transformation in recent years, 2) Japanese \\ncorporates reducing exposure to Chinese companies. FPT benefits due to the \\nadvantage of low costs as well as the ability to provide many diverse products \\nand services. The Japan acceleration offsets US deceleration, sales growth in \\nthe US slowed to 14.2% yoy in 9M23 from 42.4% yoy a year ago as the negative \\nimpact from the prolonged monetary tightening by the Fed.  \\nWe expect that FPT\'s overseas IT outsourcing services-maintained c.27% yoy \\ngrowth in the long-term base on: \\n• \\nFPT continued to focus on M&A strategy to expand its consulting \\ncapacity worldwide: 1) In October, FPT entered into a strategic \\npartnership with Landing AI, a computer vision platform in the U.S. With \\nthe partnership, FPT will look to implement computer vision solutions for \\nautomotive, manufacturing, healthcare and other industries. FPT and \\nLanding AI will also look to educate and train people in AI in Vietnam. \\nFPT expects to have more revenue from AI in FY24F to improve \\noperating efficiency (due to higher profit margins than FPT\'s traditional \\nservices). This revenue stream is currently relatively small. 2) In \\nNovember, FPT announced the acquisition 100% of Cardinal Peak (a \\nUS-based technology service provider with a customer base of more \\nthan 300 companies) to strengthen its product engineering capabilities \\nin North America. Through this transaction, FPT will be able to offer their \\nservices to existing Cardinal Peak customers, and leverage Cardinal \\nPeak\'s expertise and 20 years of experience into its existing technology \\ncapabilities to serve its existing clients. 3) In December, FPT announced \\nits acquisition of an 80% stake in French IT consulting firm AOSIS.  FPT \\nplans to leverage AOSIS\'s prowess in SAP, Data, Cloud, and Business \\nintelligence solutions, with a focus on the aerospace, aviation, and \\n"), Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 4, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=" \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n5 \\ntransportation sectors. With over 100 local experts and four offices \\njoining its existing global network, the company is poised to strengthen \\nits best-shore delivery capabilities for the French and European \\nmarkets. \\n• \\nAbility to unlock new clients and win larger-orders should support \\nits long-term growth: Regarding its strategy in key international \\nmarkets such as Japan, America, etc, FPT targets mega customers \\n(revenue of USD1 - 5m) and large customers (above +USD5m) to \\naccess high-value contracts. Notably, these companies cannot easily \\nchange partners, so signed contracts often have long-term value, \\nensuring medium-term revenue for businesses. In 9M23, the number of \\nmega deals increased from 115 to 153 and the number of the large deals \\nalso increased from 18 to 20 with the value of large deals increased by \\n66% yoy, confirming the effectiveness of FPT\'s shift to larger client’s \\nstrategy. We believe that enhancing FPT\'s technological capabilities will \\nalso help the company win more large contracts in the future. \\nFigure 6: FPT’s global IT services revenue by markets in 9M23 \\n(VNDbn) \\n \\nFigure 7: Number of clients with revenue above US$1m \\n \\n \\n \\n   Source: Company Report  \\n   Source: VNDIRECT RESEARCH \\n \\nWe expect that FPT\'s technology revenue will maintain their growth trajectory to \\ndeliver a growth of CAGR 23.5% in FY23-25F. In which global IT services is \\nexpected to reach CAGR 27.7% in FY23-25F driven by 1) Positive revenue \\nexpectations for the Japanese market and APAC and 2) IT spending in the US \\nand EU will improve in FY24-25F. \\nEducation is FPT’s fastest growing business.  \\nThe segment posted 53.4% yoy revenue growth in 9M23. FPT Education also \\ngenerates PBT margin of 37% in 9M23, which is the highest profit margin of any \\nof FPT’s business segments. We expect the education business may still \\nmaintain its strong growth momentum in FY23-25F base on:  \\n• \\nFPT increased its investment in education segment. FPT allocated \\n29% of its 2023 investment budget for education, equivalent \\n"), Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 5, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=\' \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n6 \\nVND1,700bn (+112.5% yoy). Segment capex has increased by 33% \\nCAGR in 2018-2023, reflects the commitment to education.  \\n• \\nFPT expands training sector. In Sep’23, FPT University established \\nsemiconductor and microelectronics departments to enrol the first batch \\nof students in 2024. FPT Vietnam has proposed a framework to the \\ngovernment to train 30,000-50,000 semiconductor engineers by 2030. \\nIn additional, in October, FPT and Landing AI launched a project to \\neducate and train people in AI in Vietnam. Dr. Andrew Ng (Landing AI’s \\nfounder and CEO, cofounder of Google Brain, and former Chief Scientist \\nat Baidu) will serve as advisor to FPT to create a comprehensive AI \\ncurriculum for students from grade 1 to grade 12. We believe that \\ninvesting in education and the workforce should support IT talent pool \\nto grow in the coming years, leading to attracting investments from large \\ninternational companies, which should further develop technological \\ncapacity in Vietnam. \\nWe forecast education revenue to grow by +39% yoy in FY23F and 28% yoy in \\nFY24/FY25F, a key driver of our expected earnings growth given that the \\neducation segment’s 9M23 PBT margin of 37% is the highest of any of FPT’s \\nbusiness segments.  \\nFigure 8: FPT doubled its investment in education in 2023 vs 2022 \\n(VNDbn) \\n \\nFigure 9: FPT’s yearly average students from 2017-2025 \\n \\n \\n \\n   Source: Company Report  \\n   Source: VNDIRECT RESEARCH \\n \\n \\n \\n \\n\'), Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 6, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=" \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n7 \\nValuation \\nReiterate ADD with a higher TP of VND117,300 \\nWe maintain our rating Add with raising the 1-year target price to 117,300 \\nVND/share (21.9% upside). Our valuation is based on SOTP of three main \\nbusiness segments\'s P/E target valuation. We use average adjusted P/E of \\npeers at 21.0x for technology segment, while use 15.0x P/E for \\ntelecommunication segment (lower than peers’ average) as moderate growth in \\ncoming years. We also apply 15.0x P/E target for education as same as P/E \\nVNIndex with heavily invested and is expected to made a strong growth in \\ncoming years. \\nOverall, our TP equal to P/E of 22.5x and 18.4x for FY23/FY24F, respectively. \\nFigure 10: P/E-based valuation \\n \\n   Source: VNDIRECT RESEARCH \\n \\nFigure 11: Peer comparison (as of 14/12/2023) \\n \\n \\n   Source: VNDIRECT RESEARCH, BLOOMBERG \\nNote: Adjusted P/E = P/E ratio divided by the relevant market average times the P/E of the VN-Index. \\nVNDbn\\nFPT\'s \\nownership\\nNP 2024F\\nP/E\\nEquity value \\nFY24F\\nTechnology\\n100%\\n4,542\\n              \\n21.0\\n                 \\n95,379\\n               \\nTelecommunication\\n46%\\n2,860\\n              \\n15.0\\n                 \\n19,686\\n               \\nEducation\\n100%\\n2,262\\n              \\n15.0\\n                 \\n33,934\\n               \\nTotal\\n148,999\\n             \\nEquity value FY23F (VNDbn)\\n148,999\\n             \\nOutstanding share\\n1,270,000,000\\nValue per share (VND/share)\\n117,322\\n             \\nTarget price (rounded) (VND/share)\\n117,300\\n             \\n"), Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 7, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=\' \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n8 \\nFigure 12: Sensitivity analysis table valuation \\n \\n   Source: VNDIRECT RESEARCH \\n \\n \\nFPT is trading at trailling P/E of 19.8x, which is higher than its 3-year average \\ntrailing P/E (17.6x) but significantly lower than regional peers average (31.6x). \\nOur TP implies an 18.4x P/E forward FY24F, which we think is attractive \\nregarding solid earnings growth of CAGR 22% in FY23-25F. \\nFigure 13: P/E of FPT vs technology peers \\n \\n   Source: VNDIRECT RESEARCH \\n \\n \\n \\n \\n \\n \\n \\nDownside risk: \\n• \\nInability to gain market share in competition from Indian peers in \\noverseas markets. In the global market, India is generally the first IT \\noutsourcing destination for businesses given that it has a mature \\nsoftware industry with a large number of skillful IT specialists. As such, \\nIndia will continue to be a favorite destination for IT services. We \\nbelieve that competition from Indian rivals is a big challenge for FPT in \\nterms of its ability to gain global market share.  \\n• \\nShortage of IT personnel and increase in labor costs. FPT’s IT services \\nsector is labor-intensive, hence, a significant increase in labor costs \\nmay affect the company’s operating costs.  \\n• \\nThe longer-than-expected recession impacting IT services spend  \\n• \\nForeign exchange risk: FPT’s costs tend to be in local currency, while \\nrevenues are in foreign currency.  \\n\'), Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 8, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=\' \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n9 \\n• \\nFierce competition in the telecom segment. We believe two large state-\\nowned carriers – Viettel (Unlisted) and VNPT (Unlisted) is a concern for \\nFPT in the telecom segment. In order to compete, FPT needs to boost \\nspending on upgrading infrastructure and provide value-added services \\non its products to expand its penetration, which would lead to rising \\ninvestment costs. \\nPotential re-rating catalysts  \\n• \\nHigher-than-expected global IT services revenue since FY24F. FPT is \\nfocusing on M&A to expand its brand and customer base overseas to \\nexpand its digital transformation business extensively, translating into \\ngreat potential for the company, in our view. Successful M&A deals will \\nhelp FPT increase market share in the oversea. \\n \\n \\n \\n\'), Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 9, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=" \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n10 \\nValuation \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\nSource: VND RESEARCH \\n \\n \\n0%\\n1%\\n2%\\n4%\\n5%\\n6%\\n7%\\n6.7\\n8.7\\n10.7\\n12.7\\n14.7\\n16.7\\n18.7\\n01-21A\\n07-21A\\n01-22A\\n07-22A\\n01-23E\\n07-23E\\nRolling P/E (x) (lhs)\\nEPS growth (rhs)\\n23.0%\\n23.7%\\n24.4%\\n25.1%\\n25.9%\\n26.6%\\n27.3%\\n28.0%\\n1.5\\n2.0\\n2.5\\n3.0\\n3.5\\n4.0\\n4.5\\n5.0\\n01-21A\\n07-21A\\n01-22A\\n07-22A\\n01-23E\\n07-23E\\nRolling P/B (x) (lhs)\\nROAE (rhs)\\nIncome statement\\n(VNDbn)\\n12-23E\\n12-24E\\n12-25E\\nNet revenue\\n53,152\\n63,513\\n76,203\\nCost of sales\\n(31,783)\\n(37,941)\\n(45,476)\\nGen & admin expenses\\n(5,315)\\n(6,351)\\n(7,620)\\nSelling expenses\\n(7,441)\\n(8,892)\\n(10,668)\\nOperating profit\\n8,612\\n10,329\\n12,438\\nOperating EBITDA\\n6,201\\n7,485\\n8,998\\nDepreciation and amortisation\\n2,412\\n2,845\\n3,441\\nOperating EBIT\\n8,612\\n10,329\\n12,438\\nInterest income\\n2,066\\n1,938\\n2,142\\nFinancial expense\\n(1,471)\\n(1,313)\\n(1,508)\\nNet other income\\n64\\n77\\n92\\nIncome from associates & JVs\\n155\\n471\\n573\\nPre-tax profit\\n9,427\\n11,503\\n13,738\\nTax expense\\n(1,458)\\n(1,779)\\n(2,124)\\nMinority interest\\n(1,353)\\n(1,651)\\n(1,972)\\nNet profit\\n6,616\\n8,072\\n9,641\\nAdj. net profit to ordinary\\n6,616\\n8,072\\n9,641\\nOrdinary dividends\\n(2,540)\\n(2,540)\\n(2,540)\\nRetained earnings\\n4,076\\n5,532\\n7,101\\nBalance sheet\\n(VNDbn)\\n12-23E\\n12-24E\\n12-25E\\nCash and equivalents\\n14,069\\n20,526\\n28,607\\nShort term investments\\n20,047\\n21,906\\n23,954\\nAccounts receivables\\n9,251\\n11,055\\n13,263\\nInventories\\n2,082\\n2,485\\n2,979\\nOther current assets\\n1,493\\n1,785\\n2,141\\nTotal current assets\\n46,943\\n57,757\\n70,945\\nFixed assets\\n15,242\\n18,827\\n24,352\\nTotal investments\\n3,113\\n3,458\\n3,878\\nOther long-term assets\\n4,798\\n5,734\\n6,879\\nTotal assets\\n70,096\\n85,776\\n106,055\\nShort-term debt\\n19,504\\n21,565\\n24,495\\nAccounts payable\\n3,766\\n4,496\\n5,389\\nOther current liabilities\\n12,851\\n18,830\\n26,434\\nTotal current liabilities\\n36,122\\n44,891\\n56,318\\nTotal long-term debt\\n1,773\\n2,128\\n2,554\\nOther liabilities\\n336\\n401\\n481\\nShare capital\\n12,700\\n12,700\\n12,700\\nRetained earnings reserve\\n11,063\\n15,688\\n21,812\\nShareholders\' equity\\n26,632\\n31,889\\n38,692\\nMinority interest\\n5,232\\n6,466\\n8,010\\nTotal liabilities & equity\\n70,096\\n85,776\\n106,055\\nCash flow statement\\n(VNDbn)\\n12-23E\\n12-24E\\n12-25E\\nPretax profit\\n9,427\\n11,503\\n13,738\\nDepreciation & amortisation\\n2,412\\n2,845\\n3,441\\nTax paid\\n(1,458)\\n(1,779)\\n(2,124)\\nOther adjustments\\n78\\n86\\n99\\nChange in working capital\\n3,683\\n6,563\\n8,281\\nCash flow from operations\\n14,141\\n19,218\\n23,433\\nCapex\\n(3,106)\\n(4,454)\\n(6,238)\\nProceeds from assets sales\\n0\\n0\\n0\\nOthers\\n(7,011)\\n(1,859)\\n(2,048)\\nOther non-current assets changes\\n0\\n0\\n0\\nCash flow from investing activities\\n(10,117)\\n(6,313)\\n(8,286)\\nNew share issuance\\n0\\n0\\n0\\nShares buyback\\n0\\n0\\n0\\nNet borrowings\\n8,896\\n2,416\\n3,355\\nOther financing cash flow\\n0\\n(382)\\n(824)\\nDividends paid\\n(3,175)\\n(3,175)\\n(3,175)\\nCash flow from financing activities\\n5,721\\n(1,141)\\n(644)\\nCash and equivalents at beginning of period\\n6,440\\n14,069\\n20,526\\nTotal cash generated\\n9,745\\n11,763\\n14,504\\nCash and equivalents at the end of period\\n16,185\\n25,832\\n35,030\\n"), Document(metadata={\'source\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'file_path\': \'https://www.vndirect.com.vn/vndirect-resource/nextcom/attachment/2023-12-15/FPT_Update_20231215.pdf\', \'page\': 10, \'total_pages\': 11, \'format\': \'PDF 1.7\', \'title\': \'\', \'author\': \'Tung Nguyen Ha Duc (Research & Data-VND HO)\', \'subject\': \'\', \'keywords\': \'\', \'creator\': \'Microsoft® Word 2016\', \'producer\': \'Microsoft® Word 2016\', \'creationDate\': "D:20231215172957+07\'00\'", \'modDate\': "D:20231215172957+07\'00\'", \'trapped\': \'\'}, page_content=\' \\n \\n \\n \\n \\n \\n \\n \\n \\n15 December 2023 \\nUpdate Report \\nwww.vndirect.com.vn \\n \\n11 \\n \\n \\n \\n \\n \\n \\nDISCLAIMER \\nThis report has been written and distributed by Research Department, VNDIRECT Securities Corporation. The information contained in \\nthis report is prepared from data believed to be correct and reliable at the time of issuance of this report. Unless otherwise stated, this \\nreport is based upon sources that VNDIRECT considers to be reliable. These sources may include but are not limited to data from the \\nstock exchange or market where the subject security is listed, or, where appropriate, any other market. Information on the company(ies) \\nare based on published statements, information disclosure and announcements of the company(ies), and information resulting from our \\nresearch. VNDIRECT has no responsibility for the accuracy, adequacy or completeness of such information. \\nAll estimates, projections, forecasts and expression of opinions contained in this report reflect the personal views and opinions of the \\nanalyst(s) responsible for the production of this report. These opinions may not represent the views and position of VNDIRECT and may \\nchange without notice. \\nThis report has been prepared for information purposes only. The information and opinions in this report should not be considered as an \\noffer, recommendation or solicitation to buy or sell the subject securities, related investments or other financial instruments. VNDIRECT \\ntakes no responsibility for any consequences arising from using the content of this report in any form.  \\nThis report and all of its content belongs to VNDIRECT. No part of this report may be copied or reproduced in any form or redistributed \\nin whole or in part, for any purpose without the prior written consent of VNDIRECT. \\n \\nRECOMMENDATION FRAMEWORK \\nStock Ratings \\nDefinition: \\n Add \\nThe stock’s total return is expected to reach 15% or higher over the next 12 months. \\n Hold \\nThe stock’s total return is expected to be between negative 10% and positive 15% over the next 12 months. \\n Reduce \\nThe stock’s total return is expected to fall below negative 10% over the next 12 months. \\nThe total expected return of a stock is defined as the sum of the: (i) percentage difference between the target price and the current \\nprice and (ii) the forward net dividend yields of the stock. Stock price targets have an investment horizon of 12 months. \\n \\n \\nGrowth Ratings \\nDefinition: \\n Positive \\nWe forecast the company to have stronger earnings growth that than peers over the investment horizon. \\n Neutral \\nWe forecast the company’s earnings growth to be in line with peers over the investment horizon. \\n Negative \\nWe forecast the company to have weaker earnings growth that than peers over the investment horizon. \\n \\n \\nValue Ratings \\nDefinition: \\n Positive \\nThe current share price is lower than peers on the basis of historical P/E, P/B or another ratio specified. \\n Neutral \\nThe current share price is in-line with peers on the basis of historical P/E, P/B or another ratio specified. \\n Negative \\nThe current share price is higher than peers on the basis of historical P/E, P/B or another ratio specified. \\n \\n \\nSector Ratings \\nDefinition: \\n Overweight \\nStocks in the sector have, on a market cap-weighted basis, a positive absolute recommendation. \\n Neutral \\nStocks in the sector have, on a market cap-weighted basis, a neutral absolute recommendation. \\n Underweight \\nStocks in the sector have, on a market cap-weighted basis, a negative absolute recommendation. \\n \\n \\n \\nBarry Weisblatt –  Head of Research \\nEmail: barry.weisblatt@vndirect.com.vn \\nBach Phan Nhu –  Senior Analyst \\nEmail: bach.phannhu@vndirect.com.vn \\nQuyen Nguyen –  Analyst \\nEmail:  quyen.nguyen2@vndirect.com.vn \\n –  \\nEmail:  \\n –  \\nEmail:  \\n –  \\nEmail:  \\n –  \\nEmail:  \\n \\nVNDIRECT Securities Corporation \\n1 Nguyen Thuong Hien Str – Hai Ba Trung Dist – Ha Noi  \\nTel: +84 2439724568 \\nEmail: research@vndirect.com.vn \\nWebsite: https://vndirect.com.vn \\n \\n\')]'}]
    compressor = ContextCompressor(documents, embeddings)
    query = 'FPT stock performance analysis 2023'
    rs = compressor.get_relevant_docs(query=query)
    printable_rs = ContextCompressor.pretty_print_docs(rs, top_n=5)
    # print(printable_rs)
    return printable_rs


if __name__ == '__main__':
    # measure run time
    import time
    start = time.time()
    ars = asyncio.run(async_main())
    end = time.time()
    print(f"Async time taken: {end-start}")

    start = time.time()
    rs = main()
    end = time.time()
    print(f"Sync time taken: {end-start}")

    print("Async result: ", ars)
    print("Sync result: ", rs)


    # rs = compressor.get_context(query=query, max_results=8)
    # print(rs)
